# Note this is an "external_components" test, not using the current baseline
substitutions:
  name: emerald-reader

esphome:
  name: $name
  friendly_name: emerald_reader
  platformio_options:
    build_flags:
      - -Wall
      - -Wextra

esp32:
  board: esp32dev
  framework:
    type: arduino

# Enable logging
logger:
  level: DEBUG

# Enable Home Assistant API
api:
  {}

ota:
  platform: esphome

wifi:
  ap:
    {}

captive_portal:

external_components:
  - source: ../esphome/components
    # requires ble_client and ble_tracker because I had to add some small features to authenticate properly
    components: [ ble_client, esp32_ble_tracker, emerald_ble ]

# optional requirement used with daily energy sensor
time:
  - platform: homeassistant
    id: homeassistant_time

esp32_ble_tracker:

ble_client:
  - mac_address: 01:02:03:04:05:06
    id: emerald_advisor

sensor:
  - platform: emerald_ble
    ble_client_id: emerald_advisor
    power:
      name: "Emerald Power"
    daily_energy:
      name: "Emerald Daily Energy"
    energy:
      name: "Emerald Total Energy"
    battery_level:
      name: "Emerald Battery"
    pairing_code: 012345
    pulses_per_kwh: 3200
    time_id: homeassistant_time # daily energy still works without a time_id, but recommended to include one to properly handle daylight savings, etc.
